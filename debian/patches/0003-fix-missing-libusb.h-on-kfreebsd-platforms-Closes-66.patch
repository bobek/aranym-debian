From: Antonin Kral <a.kral@bobek.cz>
Date: Mon, 9 Apr 2012 12:24:13 +0200
Subject: fix missing libusb.h on kfreebsd platforms (Closes: #665867)

---
 configure |   21 +++++++++++----------
 1 file changed, 11 insertions(+), 10 deletions(-)

diff --git a/configure b/configure
index ab90508..bd2e482 100755
--- a/configure
+++ b/configure
@@ -3157,8 +3157,8 @@ case "$host_cpu" in
 		ARCHFLAGS="-arch i386"
 		case "$host_os" in
 			darwin8* | darwin9* )	ISYSROOT="-mmacosx-version-min=10.4 -isysroot $DEVELOPER_SDK_DIR/MacOSX10.4u.sdk";;
-			darwin10* )	ISYSROOT="-mmacosx-version-min=10.5 -isysroot $DEVELOPER_SDK_DIR/MacOSX10.5.sdk";;
-			darwin11* )	ISYSROOT="-mmacosx-version-min=10.6 -isysroot $DEVELOPER_SDK_DIR/MacOSX10.6.sdk";;
+			darwin10* )	ISYSROOT="-mmacosx-version-min=10.4 -isysroot $DEVELOPER_SDK_DIR/MacOSX10.5.sdk";;
+			darwin11* )	ISYSROOT="-mmacosx-version-min=10.4 -isysroot $DEVELOPER_SDK_DIR/MacOSX10.6.sdk";;
 			*)
 				as_fn_error "Sorry, unknown Darwin version: $host_os" "$LINENO" 5
 				;;
@@ -9691,13 +9691,14 @@ fi
     if test "x$WITH_USBHOST" = "xno"; then
       ac_fn_c_check_header_mongrel "$LINENO" "libusb-1.0/libusb.h" "ac_cv_header_libusb_1_0_libusb_h" "$ac_includes_default"
 if test "x$ac_cv_header_libusb_1_0_libusb_h" = x""yes; then :
-
+  WITH_USBHOST="yes"
 else
-  as_fn_error "The libusb headers are missing" "$LINENO" 5
+  WITH_USBHOST="no"
 fi
 
 
-      { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libusb_init in -lusb-1.0" >&5
+      if test "x$WITH_USBHOST" = "xyes"; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libusb_init in -lusb-1.0" >&5
 $as_echo_n "checking for libusb_init in -lusb-1.0... " >&6; }
 if test "${ac_cv_lib_usb_1_0_libusb_init+set}" = set; then :
   $as_echo_n "(cached) " >&6
@@ -9741,16 +9742,16 @@ _ACEOF
   LIBS="-lusb-1.0 $LIBS"
 
 else
-  as_fn_error "The libusb library is missing" "$LINENO" 5
+  WITH_USBHOST="no"
 fi
 
-
-      LIBUSB_LIBS="-lusb-1.0"
-      WITH_USBHOST="yes"
+        LIBUSB_LIBS="-lusb-1.0"
+      fi
     fi
 
     if test "x$WITH_USBHOST" = "xno"; then
-      as_fn_error "libusb is mandatory for usb support" "$LINENO" 5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: libusb is missing, USB NF disabled" >&5
+$as_echo "$as_me: WARNING: libusb is missing, USB NF disabled" >&2;}
     fi
 fi
 
